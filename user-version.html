<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>寝室厨房打扫系统 - 用户版</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container-fluid">
        <!-- 头部信息 -->
        <header class="text-center py-4 bg-primary text-white">
            <h1>寝室厨房打扫系统 - 用户版</h1>
            <div id="current-date" class="h4"></div>
            <div id="connection-status" class="h6 mt-2">
                <span class="badge bg-warning" id="connection-badge">连接中...</span>
            </div>
        </header>

        <!-- 房间选择区域 -->
        <div class="card mb-4">
            <div class="card-header">
                <h3 class="card-title mb-0">🏠 选择您的房间</h3>
            </div>
            <div class="card-body">
                <div id="rooms-grid" class="room-grid">
                    <!-- 房间按钮将通过JavaScript动态生成 -->
                </div>
                <div class="text-center mt-3">
                    <button id="enter-btn" class="btn btn-primary btn-lg" disabled>进入系统</button>
                </div>
            </div>
        </div>

        <!-- 系统信息区域 -->
        <div id="system-info" style="display: none;">
            <!-- 当前打扫房间卡片 -->
            <div class="card mb-4">
                <div class="card-header bg-success text-white">
                    <h2 class="card-title mb-0">今日打扫房间</h2>
                </div>
                <div class="card-body text-center">
                    <div id="current-room" class="display-4 fw-bold text-success"></div>
                    <div id="room-status" class="mt-2"></div>
                </div>
            </div>

            <!-- 我的房间状态 -->
            <div class="card mb-4">
                <div class="card-header">
                    <h3 class="card-title mb-0">我的房间状态</h3>
                </div>
                <div class="card-body text-center">
                    <div id="my-room-number" class="h3 mb-3"></div>
                    <div id="my-room-status" class="h5 mb-4"></div>
                    <button id="toggle-skip-btn" class="btn btn-lg w-100"></button>
                </div>
            </div>

            <!-- 房间列表 -->
            <div class="card mb-4">
                <div class="card-header">
                    <h3 class="card-title mb-0">所有房间状态</h3>
                    <small class="text-muted">活跃房间: <span id="active-count">26</span> | 跳过房间: <span id="skip-count">0</span></small>
                </div>
                <div class="card-body">
                    <div id="rooms-container" class="row">
                        <!-- 房间列表将通过JavaScript动态生成 -->
                    </div>
                </div>
            </div>

            <!-- 打扫记录区域 -->
            <div class="card mb-4">
                <div class="card-header">
                    <h3 class="card-title mb-0">📸 打扫记录</h3>
                </div>
                <div class="card-body">
                    <!-- 拍照上传区域 -->
                    <div class="mb-3">
                        <label for="camera-input" class="form-label">上传打扫照片</label>
                        <input type="file" id="camera-input" class="form-control" accept="image/*" capture="camera">
                        <button id="upload-btn" class="btn btn-primary mt-2" disabled>确认上传</button>
                        <div class="mt-2">
                            <small class="text-muted">只有轮到您房间打扫时才能上传照片</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 历史记录 -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title mb-0">最近打扫记录</h3>
                </div>
                <div class="card-body">
                    <div id="history-list" class="list-group">
                        <!-- 历史记录将通过JavaScript动态生成 -->
                    </div>
                </div>
            </div>

            <!-- 底部按钮 -->
            <div class="text-center py-3">
                <button id="change-room-btn" class="btn btn-outline-secondary">更换房间</button>
            </div>
        </div>
    </div>

    <!-- 跳过确认模态框 -->
    <div class="modal fade" id="skipModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">永久跳过确认</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>确认房间 <span id="skip-room-number" class="fw-bold"></span> 永久不使用厨房？</p>
                    <p class="text-danger">一旦确认，该房间将永久跳过打扫，除非管理员重新设置。</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-danger" id="confirm-skip">确认永久跳过</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 重新加入确认模态框 -->
    <div class="modal fade" id="rejoinModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">重新加入确认</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>确认房间 <span id="rejoin-room-number" class="fw-bold"></span> 重新使用厨房？</p>
                    <p class="text-success">确认后，您的房间将重新加入打扫顺序。</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-success" id="confirm-rejoin">确认重新加入</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 引入Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="firebase-config.js"></script>
    <script src="user-version-sync.js"></script>
</body>
</html>

